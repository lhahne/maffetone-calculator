---
import Layout from "../layouts/Layout.astro";
---

<Layout title="VDOT Calculator (Jack Daniels)">
    <main
        class="mx-auto flex min-h-screen max-w-6xl flex-col gap-10 px-6 pb-14 pt-24"
    >
        <header class="space-y-4">
            <p
                class="text-sm font-semibold uppercase tracking-[0.3em] text-emerald-400"
            >
                Performance Lab
            </p>
            <h1
                class="text-4xl font-semibold leading-tight text-white md:text-5xl"
            >
                Find your VDOT for precision training.
            </h1>
            <p class="max-w-2xl text-lg text-slate-300">
                Enter a recent race result to calculate your VDOT score, predict
                race times, and determine your optimal training paces based on
                Jack Daniels' Running Formula.
            </p>
        </header>

        <section class="grid gap-8 lg:grid-cols-[400px_1fr]">
            <!-- Input Panel -->
            <div class="space-y-6">
                <div
                    class="rounded-3xl border border-white/10 bg-white/5 p-8 shadow-glow backdrop-blur space-y-6"
                >
                    <h2 class="text-xl font-semibold text-white">
                        Race Result
                    </h2>

                    <div class="space-y-4">
                        <div class="space-y-2">
                            <label
                                class="text-sm font-medium text-slate-400 uppercase tracking-wider"
                                >Distance (km)</label
                            >
                            <input
                                id="input-distance"
                                type="number"
                                step="0.1"
                                value="10"
                                class="w-full rounded-2xl border border-white/10 bg-slate-900/60 px-4 py-3 text-lg text-white outline-none focus:border-emerald-400 focus:ring-2 focus:ring-emerald-400/50"
                            />
                            <div class="flex flex-wrap gap-2 pt-1">
                                <button
                                    class="preset-btn px-3 py-1 text-xs rounded-full border border-white/10 bg-white/5 hover:bg-white/10"
                                    data-value="5">5k</button
                                >
                                <button
                                    class="preset-btn px-3 py-1 text-xs rounded-full border border-white/10 bg-white/5 hover:bg-white/10"
                                    data-value="10">10k</button
                                >
                                <button
                                    class="preset-btn px-3 py-1 text-xs rounded-full border border-white/10 bg-white/5 hover:bg-white/10"
                                    data-value="21.0975">HM</button
                                >
                                <button
                                    class="preset-btn px-3 py-1 text-xs rounded-full border border-white/10 bg-white/5 hover:bg-white/10"
                                    data-value="42.195">Full</button
                                >
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label
                                class="text-sm font-medium text-slate-400 uppercase tracking-wider"
                                >Time (HH:MM:SS)</label
                            >
                            <div class="flex items-center gap-2">
                                <input
                                    id="input-h"
                                    type="number"
                                    placeholder="00"
                                    min="0"
                                    value="0"
                                    class="w-full rounded-2xl border border-white/10 bg-slate-900/60 px-4 py-3 text-center text-lg text-white outline-none focus:border-emerald-400"
                                />
                                <span class="text-slate-500">:</span>
                                <input
                                    id="input-m"
                                    type="number"
                                    value="50"
                                    min="0"
                                    max="59"
                                    class="w-full rounded-2xl border border-white/10 bg-slate-900/60 px-4 py-3 text-center text-lg text-white outline-none focus:border-emerald-400"
                                />
                                <span class="text-slate-500">:</span>
                                <input
                                    id="input-s"
                                    type="number"
                                    value="00"
                                    min="0"
                                    max="59"
                                    class="w-full rounded-2xl border border-white/10 bg-slate-900/60 px-4 py-3 text-center text-lg text-white outline-none focus:border-emerald-400"
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    class="rounded-3xl border border-white/10 bg-emerald-950/20 p-8 shadow-xl backdrop-blur ring-1 ring-emerald-400/30"
                >
                    <p
                        class="text-sm uppercase tracking-[0.3em] text-emerald-400"
                    >
                        Your VDOT Score
                    </p>
                    <div
                        id="vdot-score"
                        class="mt-4 text-7xl font-bold text-white tracking-tighter"
                    >
                        --.-
                    </div>
                    <p class="mt-4 text-sm text-slate-400">
                        Higher values reflect better fitness and economy.
                    </p>
                </div>

                <div
                    class="rounded-3xl border border-white/10 bg-slate-900/60 p-6"
                >
                    <h2
                        class="text-lg font-semibold text-white uppercase tracking-wider text-sm"
                    >
                        What is VDOT?
                    </h2>
                    <p class="mt-3 text-sm text-slate-400 leading-relaxed">
                        VDOT is a value derived from your race times that
                        represents your oxygen uptake (VO2max) combined with
                        your running economy. It was developed by legendary
                        coach Jack Daniels to help runners train at the right
                        intensity.
                    </p>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="space-y-8">
                <!-- Training Paces -->
                <div
                    class="rounded-3xl border border-white/10 bg-white/5 p-8 shadow-glow backdrop-blur"
                >
                    <h2 class="text-xl font-semibold text-white mb-6">
                        Training Paces
                    </h2>
                    <div
                        class="overflow-hidden rounded-2xl border border-white/5"
                    >
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-white/5">
                                    <th
                                        class="px-6 py-4 text-sm font-semibold text-slate-300"
                                        >Zone</th
                                    >
                                    <th
                                        class="px-6 py-4 text-sm font-semibold text-slate-300"
                                        >Pace (min/km)</th
                                    >
                                    <th
                                        class="px-6 py-4 text-sm font-semibold text-slate-300"
                                        >Purpose</th
                                    >
                                </tr>
                            </thead>
                            <tbody id="training-paces-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Race Predictions -->
                <div
                    class="rounded-3xl border border-white/10 bg-white/5 p-8 shadow-glow backdrop-blur"
                >
                    <h2 class="text-xl font-semibold text-white mb-6">
                        Race Predictions
                    </h2>
                    <div
                        class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4"
                        id="race-predictions"
                    >
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        import {
            calculateVDOT,
            predictRaceTime,
            getTrainingPaces,
            formatTime,
            formatPace,
        } from "../scripts/vdot-calculator";
        import { hmsToSeconds } from "../scripts/riegel-calculator";

        function setupVDOTCalculator() {
            const inputDist = document.getElementById(
                "input-distance",
            ) as HTMLInputElement;
            const inputH = document.getElementById(
                "input-h",
            ) as HTMLInputElement;
            const inputM = document.getElementById(
                "input-m",
            ) as HTMLInputElement;
            const inputS = document.getElementById(
                "input-s",
            ) as HTMLInputElement;
            const vdotDisplay = document.getElementById("vdot-score");
            const trainingPacesBody = document.getElementById(
                "training-paces-body",
            );
            const racePredictions = document.getElementById("race-predictions");

            if (
                !inputDist ||
                !inputH ||
                !inputM ||
                !inputS ||
                !vdotDisplay ||
                !trainingPacesBody ||
                !racePredictions
            )
                return;

            const commonDistances = [
                { name: "5K", distance: 5000 },
                { name: "10K", distance: 10000 },
                { name: "Half Marathon", distance: 21097.5 },
                { name: "Marathon", distance: 42195 },
            ];

            function updateResults() {
                const distanceMeters = parseFloat(inputDist.value) * 1000;
                const timeSeconds = hmsToSeconds(
                    inputH.value,
                    inputM.value,
                    inputS.value,
                );

                if (distanceMeters > 0 && timeSeconds > 0) {
                    const vdot = calculateVDOT(distanceMeters, timeSeconds);
                    vdotDisplay!.textContent = vdot.toFixed(1);

                    // Update Training Paces
                    const paces = getTrainingPaces(vdot);
                    trainingPacesBody!.innerHTML = paces
                        .map(
                            (p) => `
                        <tr class="border-t border-white/5 hover:bg-white/5 transition-colors">
                            <td class="px-6 py-4 font-medium text-white">${p.name}</td>
                            <td class="px-6 py-4 text-emerald-400 font-mono text-lg">${formatPace(p.paceSecondsPerKm)}</td>
                            <td class="px-6 py-4 text-slate-400 text-sm">${p.description}</td>
                        </tr>
                    `,
                        )
                        .join("");

                    // Update Race Predictions
                    racePredictions!.innerHTML = commonDistances
                        .map((d) => {
                            const predictedSeconds = predictRaceTime(
                                vdot,
                                d.distance,
                            );
                            return `
                            <div class="rounded-2xl border border-white/5 bg-white/5 p-4 space-y-2">
                                <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">${d.name}</p>
                                <p class="text-2xl font-bold text-white">${formatTime(predictedSeconds)}</p>
                                <p class="text-xs text-slate-400">${formatPace(predictedSeconds / (d.distance / 1000))} min/km</p>
                            </div>
                        `;
                        })
                        .join("");
                } else {
                    vdotDisplay!.textContent = "--.-";
                    trainingPacesBody!.innerHTML = "";
                    racePredictions!.innerHTML = "";
                }
            }

            [inputDist, inputH, inputM, inputS].forEach((el) => {
                el.addEventListener("input", updateResults);
            });

            document.querySelectorAll(".preset-btn").forEach((btn) => {
                btn.addEventListener("click", () => {
                    inputDist.value = (btn as HTMLButtonElement).dataset.value!;
                    updateResults();
                });
            });

            // Initial update
            updateResults();
        }

        setupVDOTCalculator();
        document.addEventListener("astro:after-swap", setupVDOTCalculator);
    </script>
</Layout>
