---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Pace Calculator">
  <main class="mx-auto flex min-h-screen max-w-2xl flex-col items-center justify-center gap-10 px-6 pb-14 pt-24">
    <header class="space-y-4 text-center">
      <p class="text-sm font-semibold uppercase tracking-[0.3em] text-sky-300">
        Running Tools
      </p>
      <h1 class="text-4xl font-semibold leading-tight text-white md:text-5xl">
        Pace Calculator
      </h1>
      <p class="text-lg text-slate-300">
        Convert your running pace between minutes per mile and minutes per kilometer.
      </p>
    </header>

    <form
      id="pace-form"
      class="w-full space-y-8 rounded-3xl border border-white/10 bg-white/5 p-8 shadow-glow backdrop-blur"
    >
      <div class="grid gap-8 sm:grid-cols-2">
        <!-- Miles per Minute -->
        <div class="space-y-3">
          <label class="text-lg font-semibold text-white block text-center">
            Pace (min/mile)
          </label>
          <div class="flex items-center justify-center gap-2">
            <input
              id="mile-min"
              type="number"
              inputmode="numeric"
              min="0"
              placeholder="0"
              class="w-20 rounded-2xl border border-white/10 bg-slate-900/60 px-4 py-3 text-center text-lg text-white shadow-inner outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-400/50"
            />
            <span class="text-2xl text-slate-400">:</span>
            <input
              id="mile-sec"
              type="number"
              inputmode="numeric"
              min="0"
              max="59"
              placeholder="00"
              class="w-20 rounded-2xl border border-white/10 bg-slate-900/60 px-4 py-3 text-center text-lg text-white shadow-inner outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-400/50"
            />
          </div>
        </div>

        <!-- Km per Minute -->
        <div class="space-y-3">
          <label class="text-lg font-semibold text-white block text-center">
            Pace (min/km)
          </label>
          <div class="flex items-center justify-center gap-2">
            <input
              id="km-min"
              type="number"
              inputmode="numeric"
              min="0"
              placeholder="0"
              class="w-20 rounded-2xl border border-white/10 bg-slate-900/60 px-4 py-3 text-center text-lg text-white shadow-inner outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-400/50"
            />
            <span class="text-2xl text-slate-400">:</span>
            <input
              id="km-sec"
              type="number"
              inputmode="numeric"
              min="0"
              max="59"
              placeholder="00"
              class="w-20 rounded-2xl border border-white/10 bg-slate-900/60 px-4 py-3 text-center text-lg text-white shadow-inner outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-400/50"
            />
          </div>
        </div>
      </div>
    </form>
  </main>

  <script>
    import { convertPaceToKm, convertPaceToMiles } from "../scripts/pace-calculator.js";

    function setupPaceCalculator() {
      const mileMinInput = document.getElementById("mile-min") as HTMLInputElement;
      const mileSecInput = document.getElementById("mile-sec") as HTMLInputElement;
      const kmMinInput = document.getElementById("km-min") as HTMLInputElement;
      const kmSecInput = document.getElementById("km-sec") as HTMLInputElement;
      const form = document.getElementById("pace-form");

      if (!mileMinInput || !mileSecInput || !kmMinInput || !kmSecInput || !form) return;

      form.addEventListener("submit", (e) => e.preventDefault());

      let isUpdating = false;

      function updateKm() {
        if (isUpdating) return;
        isUpdating = true;

        const min = mileMinInput.value;
        const sec = mileSecInput.value;

        const result = convertPaceToKm(min, sec);

        kmMinInput.value = result.minutes.toString();
        kmSecInput.value = result.seconds < 10 ? "0" + result.seconds : result.seconds.toString();

        isUpdating = false;
      }

      function updateMiles() {
        if (isUpdating) return;
        isUpdating = true;

        const min = kmMinInput.value;
        const sec = kmSecInput.value;

        const result = convertPaceToMiles(min, sec);

        mileMinInput.value = result.minutes.toString();
        mileSecInput.value = result.seconds < 10 ? "0" + result.seconds : result.seconds.toString();

        isUpdating = false;
      }

      [mileMinInput, mileSecInput].forEach(input => {
        input.addEventListener("input", updateKm);
      });

      [kmMinInput, kmSecInput].forEach(input => {
        input.addEventListener("input", updateMiles);
      });
    }

    // Run on first load
    setupPaceCalculator();

    // Run on view transitions
    document.addEventListener('astro:after-swap', setupPaceCalculator);
  </script>
</Layout>
